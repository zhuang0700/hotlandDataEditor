{% extends "base.html" %}

{% macro header(src) %}
    {% if src == "toutiao" %}
        <td>广告主</td>
        <td>Title</td>
        <td style="width:278px">LandingPage</td>
        <td style="width:483px">素材</td>
        <td>pv</td>
        <td>亿米客户</td>
    {% endif %}
{% endmacro %}

{% macro render_data(src, row) %}
    {% if src == "toutiao" %}
        <td>{{ row[0] }}</td>
        <td>{{ row[1] }}</td>
        <td><a href="{{ row[2] }}" target="_blank">
            {% if row[2]|length <= 40 %}
                {{ row[2] }}
            {% else %}
                {{ row[2][:35] }}...
            {% endif %}
        </a></td>
        <td>
            {% for asset in row[3] %}
                <a href="{{ asset['url'] }}" target="_blank"><img src="{{ asset['url'] }}" width="150"></a>&nbsp;
            {% endfor %}
        </td>
        <td>{{ row[4] }}</td>
        <td>
            {% for c in row[5] %}
                <a href="/customer/history/{{ c }}">{{ c }}</a><br/>
            {% endfor %}
        </td>
    {% endif %}
{% endmacro %}

{% block page_content %}
    {% if welcome %}
        <div class="panel panel-default">
            <div class="panel-heading">Welcome</div>
            <div class="panel-body">
                <p>Welcome to Demand inSight Platform</p>
                <p>Powered By EMI-Cube</p>
            </div>
        </div>
    {% else %}
        <div class="panel panel-default">
            <!-- Default panel contents -->
            <div class="panel-heading">
                <h4>来源: {{ src }}</h4>
                日期: <input type="text" class="form_date date form-control" style="width:170px;display:inline" readonly value="{{begin}}" date-id="begin"/> ~
                <input type="text" class="form_date date form-control" style="width:170px;display:inline" readonly value="{{end}}" date-id="end"/><br/>
                说明:<br/>
                系统以每分钟一次的频率向目标媒体抓取一遍内容接口, 过滤出其中的广告并保存展示<br/>
                &lt;亿米客户&gt;根据落地页host到亿米数据库匹配查询相似广告主
            </div>
            <div class="panel-body"><p></p></div>
            <!-- Table -->
            <div class="container-fluid">
                <div class="row-fluid">
                    <table class="table table-bordered table-hover" style="table-layout:fixed;word-wrap:break-word;">
                        <thead>
                            <tr>
                                {{ header(src) }}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data %}
                                <tr>
                                    {{ render_data(src, row) }}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='bootstrap-datetimepicker.min.js') }}"></script>
    <link  href="{{ url_for('static', filename='bootstrap-datetimepicker.min.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', filename='locales/bootstrap-datetimepicker.zh-CN.js') }}"></script>
    <script src="{{ url_for('static', filename='date-format.js') }}"></script>
    <script type="text/javascript">
        $(".form_date").datetimepicker({
            minView: "month", //选择日期后，不会再跳转去选择时分秒
            format: "yyyy-mm-dd",
            language: 'zh-CN',
            autoclose: true
        }).on("change", function() {
            var begin = $("input[date-id=begin]").val();
            var end = $("input[date-id=end]").val();
            console.log("here")
            window.location.href = "/adi?begin=" + begin + "&end=" + end + "&src=" + "{{ src }}";
        });
    </script>
{% endblock %}
